#!/bin/bash
mkdir -p ../autogenerated
cd ../autogenerated
DIR=.
filename='./(\w*).\w*.(\w*)'

echo "Make sure you've set ACCESSTOKEN_SECRET, currently: ${ACCESSTOKEN_SECRET}"

export ACCESSTOKEN_LIFETIME=31536000
export ACCESSTOKEN_READ=true
export ACCESSTOKEN_WRITE=true
export ACCESSTOKEN_TOPIC=123
export ACCESSTOKEN_AUDIENCE=https://relay-access.practable.io

for i in $DIR/data.access.*; do
	[[ $i =~ $filename ]]
	first="${BASH_REMATCH[1]}"
	last="${BASH_REMATCH[2]}"
	out="${first}.token.${last}"
	export ACCESSTOKEN_TOPIC="$last-data"
	session token > "$out"
done

export ACCESSTOKEN_WRITE=false

for i in $DIR/log.access.*; do
	[[ $i =~ $filename ]]
	first="${BASH_REMATCH[1]}"
	last="${BASH_REMATCH[2]}"
	out="${first}.token.${last}"
	export ACCESSTOKEN_TOPIC="$last-log"
	session token > "$out"
done

for i in $DIR/video.access.*; do
	[[ $i =~ $filename ]]
	first="${BASH_REMATCH[1]}"
	last="${BASH_REMATCH[2]}"
	out="${first}.token.${last}"
	export ACCESSTOKEN_TOPIC="$last-video"
	session token > "$out"
done
